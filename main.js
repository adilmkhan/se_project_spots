!function(){"use strict";function e(e,t,r="Save",o="Saving..."){e.textContent=t?o:r}const t={formSelector:".modal__form",inputSelector:".modal__form-input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},r=(e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""},o=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.classList.remove(r.inactiveButtonClass),t.disabled=!1)};function n(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}const a=document.querySelector(".profile__edit-btn"),s=document.querySelector("#edit-profile-modal"),c=s.querySelector(".modal__button-close"),i=s.querySelector(".modal__form"),l=document.querySelector(".profile__add-btn"),d=document.querySelector("#new-post-modal"),u=d.querySelector(".modal__button-close"),m=d.querySelector(".modal__form"),_=document.querySelector(".profile__avatar-btn"),f=document.querySelector("#edit-avatar-modal"),h=f.querySelector(".modal__button-close"),v=f.querySelector(".modal__form"),y=i.querySelector("#name"),S=i.querySelector("#description"),b=document.querySelector(".profile__name"),q=document.querySelector(".profile__description"),p=m.querySelector("#image-link"),E=m.querySelector("#caption"),k=document.querySelector(".cards"),L=document.querySelector("#preview-modal"),C=L.querySelector(".modal__button-close"),g=L.querySelector(".modal__image"),$=L.querySelector(".modal__caption"),j=document.querySelector("#card-delete-modal"),U=j.querySelector(".modal__button-close"),P=j.querySelector(".modal__button-cancel"),A=j.querySelector(".modal__form"),x=document.querySelector(".profile__avatar");let D,B,I;const w=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}editProfileAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}addNewCard({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"10abc176-5f60-4222-bc96-a24c68a63c53","Content-Type":"application/json"}});w.getAppInfo().then(([e,t])=>{e.forEach(e=>{H(e)}),x.src=t.avatar,b.textContent=t.name,q.textContent=t.about}).catch(e=>{console.error(e)}),i.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;e(r,!0),w.editUserInfo({name:y.value,about:S.value}).then(e=>{b.textContent=e.name,q.textContent=e.about,O(s)}).catch(console.error).finally(()=>{e(r,!1)})}),C.addEventListener("click",function(e){O(L)});const T=document.querySelector("#card-template").content.querySelector(".cards__column");function N(e){e.classList.add("modal_is-opened"),e.addEventListener("click",z),document.addEventListener("keydown",M)}function O(e){e.classList.remove("modal_is-opened"),e.removeEventListener("click",z),document.removeEventListener("keydown",M)}a.addEventListener("click",function(){!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);o.forEach(o=>{r(e,o,t)}),n(a,t)}(i,t),N(s),y.value=b.textContent,S.value=q.textContent}),c.addEventListener("click",function(){O(s)}),l.addEventListener("click",function(){N(d)}),u.addEventListener("click",function(){O(d)}),_.addEventListener("click",function(){N(f)}),h.addEventListener("click",function(){O(f)}),U.addEventListener("click",function(){O(j)}),P.addEventListener("click",function(){O(j)}),v.addEventListener("submit",function(r){r.preventDefault();const o=r.submitter;e(o,!0),w.editProfileAvatar({avatar:J.value}).then(e=>{x.src=e.avatar,x.alt="",v.reset(),n(v.querySelector(t.submitButtonSelector),t),O(f)}).catch(console.error).finally(()=>{e(o,!1)})});const J=v.querySelector("#image-link");function H(e){const t=function(e){const t=T.cloneNode(!0),r=t.querySelector(".cards__image");return r.src=e.link,r.alt=e.name,r.addEventListener("click",function(){g.src=e.link,g.alt=e.name,$.textContent=e.name,N(L)}),e.isLiked?t.querySelector(".cards__like-button").classList.add("cards__like-button_active"):t.querySelector(".cards__like-button").classList.remove("cards__like-button_active"),t.querySelector(".cards__image-description").textContent=e.name,t.querySelector(".cards__like-button").addEventListener("click",t=>function(e,t){I=t;const r=e.target.classList.contains("cards__like-button_active");w.changeLikeStatus(I,r).then(()=>{e.target.classList.toggle("cards__like-button_active")}).catch(console.error)}(t,e._id)),t.querySelector(".cards__delete-button").addEventListener("click",r=>function(e,t){D=e,B=t,N(j)}(t,e._id)),t}(e);k.prepend(t)}function z(e){e.target.classList.contains("modal")&&O(e.target)}function M(e){"Escape"===e.key&&O(document.querySelector(".modal_is-opened"))}var F;m.addEventListener("submit",function(r){r.preventDefault();const o=r.submitter;e(o,!0),w.addNewCard({name:E.value,link:p.value}).then(e=>{H(e),m.reset(),n(m.querySelector(t.submitButtonSelector),t),O(d)}).catch(console.error).finally(()=>{e(o,!1)})}),A.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;e(r,!0,"Delete","Deleting..."),w.deleteCard(B).then(()=>{D.remove(),O(j),D=null,B=null}).catch(console.error).finally(()=>{e(r,!1,"Delete","Deleting...")})}),F=t,Array.from(document.querySelectorAll(F.formSelector)).forEach(e=>{e.addEventListener("submit",function(e){e.preventDefault()}),((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),a=e.querySelector(t.submitButtonSelector);o(n,a,t),n.forEach(s=>{s.addEventListener("input",function(){((e,t,o)=>{t.validity.valid?r(e,t,o):((e,t,r,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)})(e,t,t.validationMessage,o)})(e,s,t),o(n,a,t)})})})(e,F)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLNUYsU0FBUzZGLGlCQUFpQjlHLEVBQU9ULGVBQ3BENkYsUUFBU3RGLElBQ2hCQSxFQUFZOEYsaUJBQWlCLFNBQVUsU0FBVUMsR0FDL0NBLEVBQUlDLGdCQUNOLEdBbkJzQm1DLEVBQUNuSSxFQUFhRSxLQUN0QyxNQUFNTyxFQUFZcUcsTUFBTUMsS0FDdEIvRyxFQUFZZ0gsaUJBQWlCOUcsRUFBT1IsZ0JBRWhDZ0IsRUFBZ0JWLEVBQVlJLGNBQWNGLEVBQU9QLHNCQUN2RGEsRUFBa0JDLEVBQVdDLEVBQWVSLEdBQzVDTyxFQUFVNkUsUUFBU3JGLElBQ2pCQSxFQUFhNkYsaUJBQWlCLFFBQVMsV0FuQ2hCc0MsRUFBQ3BJLEVBQWFDLEVBQWNDLEtBQ2hERCxFQUFhVyxTQUFTQyxNQVF6QmQsRUFBZUMsRUFBYUMsRUFBY0MsR0F2QnZCbUksRUFBQ3JJLEVBQWFDLEVBQWNxSSxFQUFjcEksS0FDL0QsTUFBTUMsRUFBZUgsRUFBWUksY0FBYyxJQUFJSCxFQUFhSSxZQUNoRUosRUFBYUssVUFBVVcsSUFBSWYsRUFBT0wsaUJBQ2xDTSxFQUFhWixZQUFjK0ksRUFDM0JuSSxFQUFhRyxVQUFVVyxJQUFJZixFQUFPSixhQVloQ3VJLENBQ0VySSxFQUNBQyxFQUNBQSxFQUFhc0ksa0JBQ2JySSxJQThCQWtJLENBQW1CcEksRUFBYUMsRUFBY0MsR0FDOUNNLEVBQWtCQyxFQUFXQyxFQUFlUixFQUM5QyxNQVdBaUksQ0FBa0JuSSxFQUFhRSxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoXG4gIGJ0bixcbiAgaXNMb2FkaW5nLFxuICBkZWZhdWx0VGV4dCA9IFwiU2F2ZVwiLFxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcbikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgLy9cbiAgICBidG4udGV4dENvbnRlbnQgPSBsb2FkaW5nVGV4dDtcbiAgfSBlbHNlIHtcbiAgICBidG4udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcbiAgfVxufVxuIiwiLy8gRGVjbGFyaW5nIGEgY29uZmlndXJhdGlvbiBvYmplY3QgdGhhdCBjb250YWlucyB0aGVcbi8vIG5lY2Vzc2FyeSBjbGFzc2VzIGFuZCBzZWxlY3RvcnMuXG5leHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2Zvcm0taW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5lcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7XG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG59O1xuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICBmb3JtRWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudCxcbiAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgIGNvbmZpZ1xuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgfVxufTtcblxuY29uc3QgaGFzSW52YWxpZElucHV0ID0gKGlucHV0TGlzdCkgPT4ge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICB9KTtcbn07XG5cbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufTtcblxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpXG4gICk7XG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpKTtcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICBmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuXG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gIH0pO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpIHtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0VmFsaWRhdGlvbihmb3JtRWxlbWVudCwgc2V0dGluZ3MpIHtcbiAgLy8gR2V0IGFsbCBpbnB1dCBlbGVtZW50cyBpbiB0aGUgZm9ybVxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgIGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuaW5wdXRTZWxlY3RvcilcbiAgKTtcbiAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgc2V0dGluZ3MpO1xuICB9KTtcblxuICAvLyBEaXNhYmxlIHRoZSBzdWJtaXQgYnV0dG9uXG4gIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xufVxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XG5cbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcblxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xuLy8gICB7XG4vLyAgICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBCcmlkZ2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzEtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyBdO1xuLy9Qcm9maWxlIEVkaXQgTW9kYWxzXG5jb25zdCBlZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgZWRpdENsb3NlQnV0dG9uID0gZWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiKTtcbmNvbnN0IHByb2ZpbGVGb3JtRWxlbWVudCA9IGVkaXRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuXG4vL05ldyBQb3N0IE1vZGFsc1xuY29uc3QgbmV3UG9zdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IHBvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBwb3N0Q2xvc2VCdXR0b24gPSBwb3N0TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uLWNsb3NlXCIpO1xuY29uc3QgYWRkQ2FyZEZvcm1FbGVtZW50ID0gcG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbi8vRWRpdCBQcm9maWxlIEF2YXRhciBNb2RhbHNcbmNvbnN0IGVkaXRBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idG5cIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJDbG9zZUJ1dHRvbiA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiKTtcbmNvbnN0IGF2YXRhckZvcm1FbGVtZW50ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcblxuY29uc3QgbmFtZUlucHV0ID0gcHJvZmlsZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmFtZVwiKTtcbmNvbnN0IGpvYklucHV0ID0gcHJvZmlsZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVzY3JpcHRpb25cIik7XG5cbmNvbnN0IHByb2ZpbGVOYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IHByb2ZpbGVKb2JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiKTtcblxuY29uc3QgbGlua0lucHV0ID0gYWRkQ2FyZEZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbGlua1wiKTtcbmNvbnN0IGNhcHRpb25JbnB1dCA9IGFkZENhcmRGb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcHRpb25cIik7XG5cbmNvbnN0IGNhcmRzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc1wiKTtcblxuLy9QcmV2aWV3IE1vZGFsc1xuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0Nsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1jbG9zZVwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbEltZyA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENhcHRpb24gPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcblxuLy9EZWxldGUgTW9kYWxcbmNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLWRlbGV0ZS1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2xvc2VCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19idXR0b24tY2xvc2VcIik7XG5jb25zdCBkZWxldGVNb2RhbENhbmNlbEJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvbi1jYW5jZWxcIik7XG5jb25zdCBkZWxldGVGb3JtRWxlbWVudCA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbmNvbnN0IHByb2ZpbGVBdmF0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcblxubGV0IHNlbGVjdGVkQ2FyZDtcbmxldCBzZWxlY3RlZENhcmRJZDtcbmxldCBsaWtlQ2FyZElkO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCIxMGFiYzE3Ni01ZjYwLTQyMjItYmM5Ni1hMjRjNjhhNjNjNTNcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCB1c2VyXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGVsZW1lbnQpID0+IHtcbiAgICAgIHJlbmRlckNhcmRFbGVtZW50KGVsZW1lbnQpO1xuICAgIH0pO1xuICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdXNlci5uYW1lO1xuICAgIHByb2ZpbGVKb2JFbGVtZW50LnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7IC8vIGxvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgfSk7XG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgLy9DaGFuZ2UgdGV4dCBjb250ZW50IHRvIHNhdmluZy4uLlxuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oeyBuYW1lOiBuYW1lSW5wdXQudmFsdWUsIGFib3V0OiBqb2JJbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlSm9iRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAvL2NoYW5nZSB0ZXh0IGNvbnRlbnQgYmFjayB0byBcIlNhdmVcIlxuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlKTtcbiAgICB9KTtcbn1cblxucHJvZmlsZUZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuXG5wcmV2aWV3Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIilcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fY29sdW1uXCIpO1xuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlSGFuZGxlcik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGVzY2FwZUhhbmRsZXIpO1xufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZUhhbmRsZXIpO1xuICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBlc2NhcGVIYW5kbGVyKTtcbn1cblxuZWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICByZXNldFZhbGlkYXRpb24ocHJvZmlsZUZvcm1FbGVtZW50LCBzZXR0aW5ncyk7XG4gIG9wZW5Nb2RhbChlZGl0TW9kYWwpO1xuICBuYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIGpvYklucHV0LnZhbHVlID0gcHJvZmlsZUpvYkVsZW1lbnQudGV4dENvbnRlbnQ7XG59KTtcblxuZWRpdENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZWRpdE1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Nb2RhbChwb3N0TW9kYWwpO1xufSk7XG5cbnBvc3RDbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKHBvc3RNb2RhbCk7XG59KTtcblxuZWRpdEF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuZGVsZXRlTW9kYWxDYW5jZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuYXZhdGFyRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBdmF0YXJTdWJtaXQpO1xuY29uc3QgYXZhdGFyTGlua0lucHV0ID0gYXZhdGFyRm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbWFnZS1saW5rXCIpO1xuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0UHJvZmlsZUF2YXRhcih7IGF2YXRhcjogYXZhdGFyTGlua0lucHV0LnZhbHVlIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXIuc3JjID0gZGF0YS5hdmF0YXI7XG4gICAgICBwcm9maWxlQXZhdGFyLmFsdCA9IFwiXCI7XG4gICAgICBhdmF0YXJGb3JtRWxlbWVudC5yZXNldCgpO1xuICAgICAgY29uc3Qgc3VibWl0QnV0dG9uID0gYXZhdGFyRm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgICAgICk7XG4gICAgICBkaXNhYmxlQnV0dG9uKHN1Ym1pdEJ1dHRvbiwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xufVxuXG5hZGRDYXJkRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlKTtcbiAgYXBpXG4gICAgLmFkZE5ld0NhcmQoeyBuYW1lOiBjYXB0aW9uSW5wdXQudmFsdWUsIGxpbms6IGxpbmtJbnB1dC52YWx1ZSB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICByZW5kZXJDYXJkRWxlbWVudChkYXRhKTtcbiAgICAgIGFkZENhcmRGb3JtRWxlbWVudC5yZXNldCgpO1xuICAgICAgY29uc3Qgc3VibWl0QnV0dG9uID0gYWRkQ2FyZEZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIHNldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGVjdG9yXG4gICAgICApO1xuICAgICAgZGlzYWJsZUJ1dHRvbihzdWJtaXRCdXR0b24sIHNldHRpbmdzKTtcbiAgICAgIGNsb3NlTW9kYWwocG9zdE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlbmRlckNhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7XG4gIGNhcmRzQ29udGFpbmVyLnByZXBlbmQoY2FyZEVsKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19faW1hZ2VcIik7XG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgIHByZXZpZXdNb2RhbEltZy5zcmMgPSBkYXRhLmxpbms7XG4gICAgcHJldmlld01vZGFsSW1nLmFsdCA9IGRhdGEubmFtZTtcbiAgICBwcmV2aWV3TW9kYWxDYXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICAvL1RPRE8gLS0gaWYgdGhlIGNhcmQgaXMgbGlrZWQsIHNldCB0aGUgYWN0aXZlIGNsYXNzIG9uIHRoZSBjYXJkXG4gIGZ1bmN0aW9uIGhhbmRsZUlzTGlrZWQoKSB7XG4gICAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgICAgY2FyZEVsZW1lbnRcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAgIC5jbGFzc0xpc3QuYWRkKFwiY2FyZHNfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FyZEVsZW1lbnRcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAgIC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZHNfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlSXNMaWtlZCgpO1xuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19pbWFnZS1kZXNjcmlwdGlvblwiKTtcbiAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuXG4gIGZ1bmN0aW9uIGhhbmxkZUxpa2VCdG4oZXZ0LCBjYXJkSWQpIHtcbiAgICBsaWtlQ2FyZElkID0gY2FyZElkO1xuICAgIGNvbnN0IGlzTGlrZWQgPSBldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRzX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgYXBpXG4gICAgICAuY2hhbmdlTGlrZVN0YXR1cyhsaWtlQ2FyZElkLCBpc0xpa2VkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkc19fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfVxuXG4gIGNvbnN0IGNhcmRMaWtlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlrZS1idXR0b25cIik7XG4gIGNhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiBoYW5sZGVMaWtlQnRuKGV2dCwgZGF0YS5faWQpKTtcblxuICBmdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRFbGVtZW50LCBjYXJkSWQpIHtcbiAgICBzZWxlY3RlZENhcmQgPSBjYXJkRWxlbWVudDtcbiAgICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9XG5cbiAgY29uc3QgY2FyZERlbGV0ZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2RlbGV0ZS1idXR0b25cIik7XG4gIGNhcmREZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpXG4gICk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSwgXCJEZWxldGVcIiwgXCJEZWxldGluZy4uLlwiKTtcbiAgYXBpXG4gICAgLmRlbGV0ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkLnJlbW92ZSgpO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgICBzZWxlY3RlZENhcmQgPSBudWxsO1xuICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIGZhbHNlLCBcIkRlbGV0ZVwiLCBcIkRlbGV0aW5nLi4uXCIpO1xuICAgIH0pO1xufVxuXG5kZWxldGVGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5cbmZ1bmN0aW9uIGNsb3NlSGFuZGxlcihldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxcIikpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVzY2FwZUhhbmRsZXIoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY2xvc2VNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKSk7XG4gIH1cbn1cblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIC8vIGNvbnN0cnVjdG9yIGJvZHlcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgLy8gVGhpcyB3b3VsZCBiZSB5b3VyIFByb21pc2UuYWxsIG1ldGhvZFxuICAgIHJldHVybiBQcm9taXNlLmFsbChbXG4gICAgICB0aGlzLmdldEluaXRpYWxDYXJkcygpLFxuICAgICAgdGhpcy5nZXRVc2VySW5mbygpLFxuICAgICAgLy8gdGhpcy5lZGl0VXNlckluZm8oKVxuICAgIF0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIC8vIC4uLlxuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE90aGVyIG1ldGhvZHMgZm9yIHdvcmtpbmcgd2l0aCB0aGUgQVBJXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIC8vIE1ldGhvZCB0byBnZXQgdXNlciBpbmZvXG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gUGFzcyB0aGUgZGF0YSBhcyBhbiBhcmd1bWVudC4gSW4gdGhpcyBleGFtcGxlLCB3ZSBhcmUgdXNpbmcgZGVzdHJ1Y3R1cmluZyxcbiAgLy8gc28gd2Ugd291bGQgbmVlZCB0byBwYXNzIHRoZSBmdW5jdGlvbiBhbiBvYmplY3Qgd2l0aCBwcm9wZXJ0aWVzIGNhbGxlZFxuICAvLyBuYW1lIGFuZCBhYm91dC5cbiAgZWRpdFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG4gIGVkaXRQcm9maWxlQXZhdGFyKHsgYXZhdGFyIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgc2VydmVyIHJldHVybnMgYW4gZXJyb3IsIHJlamVjdCB0aGUgcHJvbWlzZVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG4gIGFkZE5ld0NhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbGluayxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgZGVsZXRlQ2FyZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuICBjaGFuZ2VMaWtlU3RhdHVzKGlkLCBpc0xpa2VkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSBzZXJ2ZXIgcmV0dXJucyBhbiBlcnJvciwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuLy8gZXhwb3J0IHRoZSBjbGFzc1xuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInNldEJ1dHRvblRleHQiLCJidG4iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwidGV4dENvbnRlbnQiLCJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsImVycm9yRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsInNvbWUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGFzSW52YWxpZElucHV0IiwiZGlzYWJsZUJ1dHRvbiIsImRpc2FibGVkIiwiYWRkIiwiZWRpdEJ1dHRvbiIsImRvY3VtZW50IiwiZWRpdE1vZGFsIiwiZWRpdENsb3NlQnV0dG9uIiwicHJvZmlsZUZvcm1FbGVtZW50IiwibmV3UG9zdEJ1dHRvbiIsInBvc3RNb2RhbCIsInBvc3RDbG9zZUJ1dHRvbiIsImFkZENhcmRGb3JtRWxlbWVudCIsImVkaXRBdmF0YXJCdXR0b24iLCJhdmF0YXJNb2RhbCIsImF2YXRhckNsb3NlQnV0dG9uIiwiYXZhdGFyRm9ybUVsZW1lbnQiLCJuYW1lSW5wdXQiLCJqb2JJbnB1dCIsInByb2ZpbGVOYW1lRWxlbWVudCIsInByb2ZpbGVKb2JFbGVtZW50IiwibGlua0lucHV0IiwiY2FwdGlvbklucHV0IiwiY2FyZHNDb250YWluZXIiLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3Q2xvc2VCdG4iLCJwcmV2aWV3TW9kYWxJbWciLCJwcmV2aWV3TW9kYWxDYXB0aW9uIiwiZGVsZXRlTW9kYWwiLCJkZWxldGVNb2RhbENsb3NlQnRuIiwiZGVsZXRlTW9kYWxDYW5jZWxCdG4iLCJkZWxldGVGb3JtRWxlbWVudCIsInByb2ZpbGVBdmF0YXIiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJZCIsImxpa2VDYXJkSWQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwicmVqZWN0Iiwic3RhdHVzIiwiZWRpdFVzZXJJbmZvIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0UHJvZmlsZUF2YXRhciIsImF2YXRhciIsImFkZE5ld0NhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImNoYW5nZUxpa2VTdGF0dXMiLCJpc0xpa2VkIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzIiwidXNlciIsImZvckVhY2giLCJlbGVtZW50IiwicmVuZGVyQ2FyZEVsZW1lbnQiLCJzcmMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdEJ0biIsInN1Ym1pdHRlciIsInZhbHVlIiwiZGF0YSIsImNsb3NlTW9kYWwiLCJmaW5hbGx5IiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiY2xvc2VIYW5kbGVyIiwiZXNjYXBlSGFuZGxlciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVzZXRWYWxpZGF0aW9uIiwiYXZhdGFyTGlua0lucHV0IiwiYWx0IiwicmVzZXQiLCJjYXJkRWwiLCJjYXJkRWxlbWVudCIsImNsb25lTm9kZSIsImNhcmRJbWFnZSIsImNhcmRJZCIsInRhcmdldCIsImNvbnRhaW5zIiwidG9nZ2xlIiwiaGFubGRlTGlrZUJ0biIsIl9pZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJnZXRDYXJkRWxlbWVudCIsInByZXBlbmQiLCJrZXkiLCJzZXRFdmVudExpc3RlbmVycyIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9